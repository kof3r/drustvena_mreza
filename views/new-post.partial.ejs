<style>
#editor {
}
.wysibb {
	width: 100%;
	-webkit-box-sizing: content-box !important;
    -moz-box-sizing: content-box !important;
    box-sizing: content-box !important;
    float: left;

}
.wysibb-text-editor, .wysibb-texarea {
	min-height: 150px !important;
	padding: 15px; 
}
#main-content { box-sizing: border-box }
</style>

<form name="post-form" id="post-form">

	<div class="form-group col-sm-6 col-xs-8">
		<label for="post-title">Title</label>
			<input type="text" id="post-title" name="post-title" class="form-control" />
	</div>
	
	<div class="form-group col-sm-3 col-xs-4">
		<label>Bubble</label>
		<select id="bubble-to-post-in" name="bubble-to-post-in" class="form-control">
		</select>
	</div>
	
	<div class="form-group col-sm-3 col-xs-6">
		<label>Actions</label>
		<div>
			<input type="submit" class="btn btn-primary " value="Publish" />
			<button class="btn btn-danger" onclick="Javascript:discard();">Discard</button>
		</div>
	</div>

</form>

	<div class="col-md-12 editor">
			<textarea id="editor"></textarea>
	</div>
	

<!-- Editor -->
<script src="/javascripts/jquery.wysibb.min.js"></script>

<!-- My Bubbles -->
<script id="new-post-bubble-select-tmp" type="text/x-dot-template">
	<option></option>
	{{~it.bubbles :bubble:index}}
		<option value="{{= bubble.id }}">{{= bubble.title }}</option>
	{{~}}
</script>

<script>

function renderEditor() {
    var wbbOpt = {
    buttons: "bold,italic,underline,strike,mark,|,left,text-center,right,|,link,img,video,|,table,qoute,code|"
    }
    $("#editor").wysibb(wbbOpt);
    
    $.get('/content/myBubbles', function(data) {
    var templateFunction = doT.template(document.getElementById('new-post-bubble-select-tmp').text);
		var html = templateFunction(data);
		$('#bubble-to-post-in').html(html);
	});
}

function discard() {
	window.history.back();
}

$('#post-form').on('submit', function(event) {
	event.preventDefault();
	
	var title = document.getElementById('post-title').value;
	var bubble = $('#bubble-to-post-in').val();
	var content = $("#editor").bbcode();
	var postData = {bubble_id: bubble,
					content: content,
					title: title,
					description: ''};
	
	if (title == '')	{ $('#post-title').focus();}
	else if (bubble == '') { $('#bubble-to-post-in').focus();}
	else if (content == '') { $('#editor').focus();}
					
	else {
		$.post('/content/post', postData, function(success) {
			window.history.back();
		});
	}
	return false;
});

$(document).ready(renderEditor);

</script>